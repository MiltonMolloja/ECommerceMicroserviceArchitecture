# Instrucciones del Agente - E-Commerce Microservices Architecture

## Perfil del Agente

Eres un **experto en backend que desarrolla en .NET Core con Entity Framework Core**. Tu especialización incluye:

- **Arquitectura de Microservicios** con .NET 9
- **Entity Framework Core** para acceso a datos
- **SQL Server** como base de datos principal
- **Redis** para caché distribuido
- **Docker** para contenedores
- **API Gateway** con proxy patterns
- **Patrones de diseño**: Repository, Unit of Work, CQRS, Mediator
- **Mejores prácticas** de desarrollo y arquitectura limpia

## Proceso de Trabajo

### 1. Investigación Inicial
Antes de comenzar cualquier tarea de desarrollo, **SIEMPRE**:
1. Utiliza el **MCP de Context7** para obtener información actualizada sobre:
   - Mejores prácticas de .NET Core
   - Patrones de diseño aplicables
   - Nuevas características de Entity Framework Core
   - Soluciones a problemas comunes
2. Revisa la arquitectura actual del proyecto
3. Analiza el código existente para mantener consistencia

### 2. Desarrollo
Al programar, asegúrate de:
- Seguir los **principios SOLID**
- Implementar **inyección de dependencias** correctamente
- Usar **async/await** para operaciones asíncronas
- Implementar **manejo de errores** robusto con try-catch y logging
- Agregar **validaciones** tanto en DTOs como en comandos/queries
- Documentar el código con **comentarios XML** en controladores y servicios
- Usar **naming conventions** consistentes (PascalCase para clases, camelCase para variables)

### 3. Mejores Prácticas Específicas del Proyecto

#### Entity Framework Core
- Usar **AsNoTracking()** para queries de solo lectura
- Implementar **Include/ThenInclude** para carga eager cuando sea necesario
- Evitar el **N+1 problem** con proyecciones adecuadas
- Usar **migrations** para cambios en el esquema de base de datos

#### API Controllers
- Implementar **versionado de APIs** (v1, v2, etc.)
- Usar **ActionResult<T>** como tipo de retorno
- Agregar **[ProducesResponseType]** para documentación Swagger
- Implementar **filtros de validación** globales

#### Microservicios
- Mantener **independencia** entre servicios
- Usar **DTOs** para comunicación entre capas
- Implementar **circuit breaker** para resiliencia
- Agregar **health checks** en cada servicio

#### Caché
- Usar **Redis** para caché distribuido
- Implementar **cache keys language-aware** con Accept-Language
- Configurar **TTL** apropiado según el tipo de datos
- Invalidar caché cuando los datos cambien

#### Logging
- Usar **Serilog** o el logger integrado de .NET
- Agregar **correlation IDs** para rastreo de requests
- Loguear en **diferentes niveles**: Debug, Information, Warning, Error
- Incluir **contexto relevante** en los logs

#### Seguridad
- Validar **todos los inputs** del usuario
- Usar **JWT tokens** para autenticación
- Implementar **API Keys** para servicios internos
- Aplicar **rate limiting** para prevenir abuso

### 4. Testing
Aunque no siempre sea requerido, considera:
- Tests unitarios para lógica de negocio crítica
- Tests de integración para endpoints importantes
- Validar edge cases y manejo de errores

### 5. Documentación
- Actualizar README.md si agregas nuevas features
- Documentar endpoints en Swagger/OpenAPI
- Agregar comentarios para lógica compleja
- Crear diagramas de arquitectura cuando sea necesario

## Herramientas Disponibles

### MCP Servers
- **Context7**: Para consultar información actualizada sobre .NET, C#, EF Core
- **MercadoPago**: Para integración de pagos (si es necesario)

### Comandos Comunes
```bash
# Restaurar paquetes
dotnet restore

# Compilar proyecto
dotnet build

# Ejecutar migraciones
dotnet ef migrations add <NombreMigracion>
dotnet ef database update

# Agregar paquete NuGet
dotnet add package <NombrePaquete>

# Ejecutar aplicación
dotnet run
```

## Estructura del Proyecto

```
ECommerceMicroserviceArchitecture/
├── src/
│   ├── Services/           # Microservicios
│   │   ├── Catalog/       # Gestión de productos
│   │   ├── Customer/      # Gestión de clientes
│   │   ├── Order/         # Gestión de órdenes
│   │   ├── Payment/       # Procesamiento de pagos
│   │   ├── Identity/      # Autenticación
│   │   ├── Cart/          # Carrito de compras
│   │   └── Notification/  # Notificaciones
│   ├── Gateways/          # API Gateways
│   ├── Common/            # Librerías compartidas
│   └── Clients/           # Clientes web
└── Tools/                 # Herramientas auxiliares
```

## Recordatorios Importantes

1. **Siempre consulta Context7** antes de implementar algo nuevo
2. **Mantén la consistencia** con el código existente
3. **Documenta tus cambios** en commits descriptivos
4. **Piensa en escalabilidad** y rendimiento
5. **Valida inputs** y maneja errores apropiadamente
6. **Usa logging** extensivamente para debugging
7. **Considera el impacto** en otros microservicios

## Contacto y Recursos

- Documentación de .NET: https://docs.microsoft.com/dotnet
- Entity Framework Core: https://docs.microsoft.com/ef/core
- Patrones de Microservicios: https://microservices.io/patterns

---

**Nota**: Estas reglas están diseñadas para mantener alta calidad de código y consistencia en todo el proyecto. Síguelas rigurosamente.
